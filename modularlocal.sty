% Copyright 2017 Daniel Thomas Sank (sank.daniel@gmail.com)
%
% This work may be distributed under the terms of the LPPL.
% See README.md for details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{modularlocal}[2016/12/27 Modular document design]
\RequirePackage{ifthen}
\RequirePackage{import}


% COPIED FROM COSEOUL
\newcommand{\chex}{}
\newcounter{currentlevel}
% part = 7
% chapter = 6
% section = 5
% subsection = 4
% subsubsection = 3
% paragraph = 2
% subparagraph = 1

\ifthenelse{\isundefined{\chapter}}%
	{\renewcommand{\chex}{N}\setcounter{currentlevel}{5}}%
	{\renewcommand{\chex}{Y}\setcounter{currentlevel}{6}}

\newcommand{\findnewlevel}[1]% uppity (-1 down, 0 stay, 1 up, 2-6 multiup
{	\addtocounter{currentlevel}{#1}%
	\ifthenelse{\equal{\chex}{N}}%
	{	\ifthenelse{\value{currentlevel} = 6}%
		{	\ifthenelse{#1 > 1}{\addtocounter{currentlevel}{1}}%
				{\addtocounter{currentlevel}{-1}}}{}}{}%
	\ifthenelse{\value{currentlevel} < 1}{\setcounter{currentlevel}{1}}{}%
	\ifthenelse{\value{currentlevel} > 7}{\setcounter{currentlevel}{7}}{}%
}

% Level change commands that print autogenerated numbers
\newcommand{\levelchange}[2]% title, uppity
{	\findnewlevel{#2}%
	\ifthenelse{\value{currentlevel} = 1}{\subparagraph{#1}}{}%
	\ifthenelse{\value{currentlevel} = 2}{\paragraph{#1}}{}%
	\ifthenelse{\value{currentlevel} = 3}{\subsubsection{#1}}{}%
	\ifthenelse{\value{currentlevel} = 4}{\subsection{#1}}{}%
	\ifthenelse{\value{currentlevel} = 5}{\section{#1}}{}%
	\ifthenelse{\value{currentlevel} = 6}{\chapter{#1}}{}%
	\ifthenelse{\value{currentlevel} = 7}{\part{#1}}{}%
}
\newcommand{\levelup}[1]{\levelchange{#1}{1}}
\newcommand{\leveldown}[1]{\levelchange{#1}{-1}}
\newcommand{\levelstay}[1]{\levelchange{#1}{0}}
\newcommand{\levelmultiup}[2]{\levelchange{#1}{#2}} %title, uppity	

% Level change commands without autogenerated numbers
\newcommand{\levelchangenonumber}[2]% title, uppity
{	\findnewlevel{#2}%
	\ifthenelse{\value{currentlevel} = 1}{\subparagraph*{#1}}{}%
	\ifthenelse{\value{currentlevel} = 2}{\paragraph*{#1}}{}%
	\ifthenelse{\value{currentlevel} = 3}{\subsubsection*{#1}}{}%
    \ifthenelse{\value{currentlevel} = 4}{\subsection*{#1}\addcontentsline{toc}{subsection}{#1}}{}%
	\ifthenelse{\value{currentlevel} = 5}{\section*{#1}\addcontentsline{toc}{section}{#1}}{}%
	\ifthenelse{\value{currentlevel} = 6}{\chapter*{#1}\addcontentsline{toc}{chapter}{#1}}{}%
	\ifthenelse{\value{currentlevel} = 7}{\part*{#1}\addcontentsline{toc}{part}{#1}}{}%
}
\newcommand{\levelupnon}[1]{\levelchangenonumber{#1}{1}}
\newcommand{\leveldownnon}[1]{\levelchangenonumber{#1}{-1}}
\newcommand{\levelstaynon}[1]{\levelchangenonumber{#1}{0}}
\newcommand{\levelmultiupnon}[2]{\levelchangenonumber{#1}{#2}} %title, uppity	


% my stuff
\makeatletter
\newcounter{currentimportdepth}
\setcounter{currentimportdepth}{0}
\newcommand{\subimportlevel}[3]{
  \expandafter\edef\csname @currentlevel\thecurrentimportdepth\endcsname{\thecurrentlevel}
  \addtocounter{currentimportdepth}{1}
  \addtocounter{currentlevel}{-#3}
  \subimport*{#1}{#2}
  \addtocounter{currentimportdepth}{-1}
  \setcounter{currentlevel}{\csname  @currentlevel\thecurrentimportdepth\endcsname}
  }
\makeatother

